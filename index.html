<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å‹‰å¼·ã‚¿ã‚¤ãƒãƒ¼ï¼‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>

<style>
body {
  font-family: sans-serif;
  background: #0b1020;
  color: white;
  text-align: center;
}
input, button {
  font-size: 1rem;
  padding: 0.4rem;
  margin: 0.2rem;
}
button { cursor: pointer; }

#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  max-width: 420px;
  margin: 20px auto;
}
.day {
  border: 1px solid #444;
  min-height: 70px;
  font-size: 0.8rem;
}
.day span {
  display: block;
  font-weight: bold;
}
.event {
  background: #ffcc00;
  color: black;
  margin: 2px;
  border-radius: 4px;
  font-size: 0.7rem;
}

canvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
}
</style>
</head>

<body>

<h1>ğŸ“š å‹‰å¼·ã‚¿ã‚¤ãƒãƒ¼</h1>

<div>
  <label>
    æ•™ç§‘ï¼š
    <input type="text" id="subject" placeholder="æ•°å­¦ / è‹±èª / åŒ–å­¦ãªã©">
  </label>
</div>

<div>
  <label>
    æ—¥ä»˜ï¼š
    <input type="date" id="studyDate">
  </label>
</div>

<div>
  <label>
    å‹‰å¼·æ™‚é–“ï¼ˆåˆ†ï¼‰ï¼š
    <input type="number" id="minutes" value="25">
  </label>
</div>

<div>
  <button onclick="startTimer()">â–¶ é–‹å§‹</button>
  <button onclick="stopTimer()">â¹ çµ‚äº†</button>
</div>

<h2 id="status">å¾…æ©Ÿä¸­</h2>

<h2>ğŸ“† ä»Šæœˆã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
<div id="calendar"></div>

<canvas id="fireworks"></canvas>

<script>
/* ---------- åˆæœŸè¨­å®š ---------- */
const todayStr = new Date().toISOString().slice(0, 10);
document.getElementById("studyDate").value = todayStr;

let timerId = null;
let saved = false;

const events = JSON.parse(localStorage.getItem("events") || "[]");

/* ---------- ã‚¿ã‚¤ãƒãƒ¼ ---------- */
function startTimer() {
  stopTimer(false);
  saved = false;

  const minutes = Number(document.getElementById("minutes").value);
  const end = Date.now() + minutes * 60000;

  document.getElementById("status").textContent = "é›†ä¸­ä¸­â€¦";

  timerId = setInterval(() => {
    if (Date.now() >= end) stopTimer(true);
  }, 500);
}

function stopTimer(save = true) {
  if (timerId) clearInterval(timerId);
  timerId = null;
  document.getElementById("status").textContent = "çµ‚äº†ï¼";

  if (save && !saved) {
    saveEvent();
    renderCalendar();
    launchFireworks();
    saved = true;
  }
}

/* ---------- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ---------- */
function saveEvent() {
  const date = document.getElementById("studyDate").value;
  const subject = document.getElementById("subject").value || "å‹‰å¼·";

  events.push({ date, subject });
  localStorage.setItem("events", JSON.stringify(events));
}

const calendarEl = document.getElementById("calendar");

function renderCalendar() {
  calendarEl.innerHTML = "";
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();

  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month + 1, 0).getDate();

  for (let i = 0; i < firstDay; i++) {
    calendarEl.appendChild(document.createElement("div"));
  }

  for (let d = 1; d <= lastDate; d++) {
    const cell = document.createElement("div");
    cell.className = "day";
    const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(d).padStart(2, "0")}`;

    cell.innerHTML = `<span>${d}</span>`;

    events
      .filter(e => e.date === dateStr)
      .forEach(e => {
        const ev = document.createElement("div");
        ev.className = "event";
        ev.textContent = e.subject;
        cell.appendChild(ev);
      });

    calendarEl.appendChild(cell);
  }
}

renderCalendar();

/* ---------- èŠ±ç« ---------- */
const canvas = document.getElementById("fireworks");
const ctx = canvas.getContext("2d");

resizeCanvas();
window.addEventListener("resize", resizeCanvas);

function resizeCanvas() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}

function launchFireworks() {
  let particles = Array.from({ length: 120 }, () => ({
    x: canvas.width / 2,
    y: canvas.height / 2,
    vx: (Math.random() - 0.5) * 8,
    vy: (Math.random() - 0.5) * 8,
    life: 80,
    color: `hsl(${Math.random() * 360},100%,60%)`
  }));

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x, p.y, 4, 4);
      p.x += p.vx;
      p.y += p.vy;
      p.life--;
    });
    particles = particles.filter(p => p.life > 0);
    if (particles.length) requestAnimationFrame(animate);
  }
  animate();
}
</script>

</body>
</html>
